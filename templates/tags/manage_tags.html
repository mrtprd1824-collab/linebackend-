{% extends "base.html" %}
{% block title %}Manage Tags{% endblock %}

{% block extra_css %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tags.css') }}">
{% endblock %}

{% block content %}
<div id="tags-page" class="container py-4 py-lg-5">
    <section class="tags-hero p-4 p-lg-5 mb-5 rounded-4">
        <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between gap-4">
            <div>
                <span class="tags-label text-uppercase fw-semibold">Collections</span>
                <h1 class="display-6 fw-semibold mb-2">จัดการแท็ก</h1>
                <p class="mb-0 text-muted">สร้างและจัดระเบียบแท็กเพื่อใช้ติดตามลูกค้าและแชทได้อย่างมีประสิทธิภาพ</p>
            </div>
            <div class="badge rounded-pill bg-light-subtle text-muted px-3 py-2 shadow-sm">
                <i class="bi bi-tags-fill me-2 text-primary"></i>จำนวนแท็กทั้งหมด: {{ tags|length }}
            </div>
        </div>
    </section>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card tags-form-card border-0 shadow-sm rounded-4 h-100">
                <div class="card-body p-4">
                    <h2 class="h5 fw-semibold mb-3"><i class="bi bi-plus-circle-fill me-2 text-primary"></i>เพิ่มแท็กใหม่</h2>
                    <p class="text-muted small mb-4">ตั้งชื่อและเลือกสีที่สะท้อนประเภทหรือหมวดหมู่ที่คุณต้องการ</p>
                    <form action="{{ url_for('tags.add_tag') }}" method="POST" class="tags-form">
                        <div class="mb-3">
                            <label for="name" class="form-label">ชื่อแท็ก</label>
                            <input type="text" class="form-control tags-input" id="name" name="name" required placeholder="เช่น VIP Customer">
                        </div>
                        <div class="mb-4">
                            <label for="color" class="form-label d-flex justify-content-between align-items-center">
                                <span>สีของแท็ก</span>
                                <code id="color-preview">#6c757d</code>
                            </label>
                            <div class="tags-color-picker">
                                <input type="color" class="form-control form-control-color" id="color" name="color" value="#6c757d" title="เลือกสีของแท็ก">
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary tags-submit">
                                <i class="bi bi-save2 me-2"></i>บันทึกแท็ก
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card tags-list-card border-0 shadow-sm rounded-4">
                <div class="card-header border-0 bg-transparent px-4 pt-4">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
                        <div>
                            <h2 class="h5 fw-semibold mb-1"><i class="bi bi-collection me-2 text-primary"></i>รายการแท็กทั้งหมด</h2>
                            <p class="text-muted small mb-0">ดูสีและจัดการลบแท็กที่ไม่ต้องการ</p>
                        </div>
                    </div>
                </div>
                <div class="card-body pt-0 px-0">
                    <div class="table-responsive">
                        <table class="table align-middle mb-0 tags-table">
                            <thead>
                                <tr>
                                    <th scope="col">Preview</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Color Code</th>
                                    <th scope="col" class="text-end">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tag in tags %}
                                <tr>
                                    <td>
                                        <span class="tags-chip" style="background-color: {{ tag.color }};">{{ tag.name }}</span>
                                    </td>
                                    <td class="fw-semibold">{{ tag.name }}</td>
                                    <td><code>{{ tag.color }}</code></td>
                                    <td class="text-end">
                                        <form action="{{ url_for('tags.delete_tag', tag_id=tag.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this tag?');">
                                            <button type="submit" class="btn btn-sm btn-outline-danger tags-delete-btn">
                                                <i class="bi bi-trash-fill"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="text-center text-muted py-4">ยังไม่มีแท็กที่สร้างไว้</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        (function () {
            const colorInput = document.getElementById('color');
            const colorPreview = document.getElementById('color-preview');
            if (!colorInput || !colorPreview) {
                return;
            }
            const syncPreview = () => {
                colorPreview.textContent = colorInput.value.toUpperCase();
            };
            syncPreview();
            colorInput.addEventListener('input', syncPreview);
        })();
    </script>
{% endblock %}
